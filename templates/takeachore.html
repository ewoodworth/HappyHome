{% extends 'base.html' %}
{% block head %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
{% endblock %}
{% block body %}
<div>
  <select id="initial-pulldown" name="freq">
    <option></option>
    {% for chore in chores %}
    <option value='{{ chore.chore_id }}'>{{ chore.name }}</option>
    {% endfor%}
  </select>
</div>
<div id='secondary-form-group'>
</div>
<div id='aggree-button-div'>
</div>
<div>
  <table>
    <tr>
      <td>
        Chore
      </td>
      <td>
        Frequency
      </td>
    </tr>
    {% for chore in chores %}
    <tr>
    <td>
    {{ chore.name }}
    </td>
    <td>
    {% if chore.frequency[0] == 'daily' %}
      Every day
    {% elif chore.frequency[0] == 'weekly' %}
      Weekly on {% for item in chore.frequency[1] %}{{ item }}, {% endfor %}
    {% elif chore.frequency[0] == 'monthly' %}
      Monthly on day {{ chore.frequency[1] }} of the month
    {% endif %}
    {% if chore.frequency[2] == '0' and chore.frequency[3] == 'ALL' %}
        at any time of day.
      {% elif chore.frequency[3] == 'MORNING' %}
        in the morning.
      {% elif chore.frequency[3] == 'EVENING' %}
        in the evening.
    {% else %}
      at {{ chore.frequency[2] }}
    {% endif %}
    </td>
    </tr>
    {% endfor %}
  </table>
</div>
    


<script>
"use strict";
  $(document).ready(function() {
    console.log("HI!!!");

    // event handler for change to the main pulldown
    var mainPull = $("#initial-pulldown");

    mainPull.change(function() {
      console.log("I'm awake!");
      // sendFormIn();
      // update the secondary menu if there's a value
      if (mainPull.val() !== "") {
        console.log('It Started!');
        sendFormIn();
      // otherwise, hide it
      } else {
        $('#secondary-form-group').hide();
        $('aggree-button-div').hide();
      }
    });

    function agreeToChore(){
      var agreementsInput = {
        "daysagreed": $('#day_0-checkbox').is(":checked").toString() + "," +
                $('#day_1-checkbox').is(":checked").toString() + "," +
                $('#day_2-checkbox').is(":checked").toString() + "," +
                $('#day_3-checkbox').is(":checked").toString() + "," +
                $('#day_4-checkbox').is(":checked").toString() + "," +
                $('#day_5-checkbox').is(":checked").toString() + "," +
                $('#day_6-checkbox').is(":checked").toString(),
        "chore_id": $('#initial-pulldown').val()
      }

          console.log(agreementsInput);

          $.post("/takeagreements", 
          agreementsInput,
          $('#secondary-form-group').empty()
          );
    }
    //DO THE OLD RULES FOR FORM ELEMENTS FROM HTML STILL MATTER? NAME VS ID?

    function successFunction(ints){
      $("#secondary-form-group").empty();
      for (var i = 0; i < chore.frequency[1].length; i++) {
        $("#secondary-form-group").append(" <input type='checkbox' id='day_" + [i] +"-checkbox' name = 'day' value=" + chore.frequency[1][i] + ">" + chore.frequency[1][i][0]);
        };
        $("#secondary-form-group").append(" <button id='agree-button'>I'll Do This!</button>")
            $("#agree-button").click(function() { 
                               agreeToChore();});
    }

      $('#secondary-form-group').show();

    function sendFormIn() {
        // evt.preventDefault();
        // HOW LONG DO VARIABLES HOLD SCOPE IN JS????
        // CAN I JUST USE THIS FUNCTION AGAIN ON LINE 45 AND ADD MORE ITEMS TO THE JSON (OBV WON'T USE THEM BOTH TIMES) <- No, wrong route
        var formInputs = {
          "numfromform": $("#initial-pulldown").val()
        }

        $.post("/takechoreform", 
            formInputs,
            successFunction
            );
    }

  });
// ^ THIS IS FROM THE DOCUMT READY TAG AT THE TOP
</script>
{% endblock %}